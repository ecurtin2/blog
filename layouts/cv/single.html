{{ define "main" }}
{{ $p := .Site.Data.profile }}
{{ $target := "site" }}
<article class="cv">
  <header class="cv-header no-print">
    <h1 class="cv-name">{{ $p.personal.name }}</h1>
    <p class="cv-tagline">{{ $p.bio.tagline }}</p>
    <p class="cv-contact">
      {{ $p.personal.location }} |
      <a href="mailto:{{ $p.personal.email }}">{{ $p.personal.email }}</a> |
      <a href="{{ $p.personal.github }}">github.com/ecurtin2</a>
    </p>
  </header>

  <div class="cv-content">
    <section class="cv-section">
      <h2>Skills</h2>
      {{ range $p.skills.groups }}
      {{ $names := slice }}
      {{ range .items }}
      {{ if or (not .included_in) (in .included_in $target) }}
      {{ $names = $names | append .name }}
      {{ end }}
      {{ end }}
      {{ if gt (len $names) 0 }}
      <p><strong>{{ .label }}:</strong> {{ delimit $names ", " }}</p>
      {{ end }}
      {{ end }}
    </section>

    <section class="cv-section">
      <h2>Experience</h2>
      {{ range $p.experience }}
      {{ if or (not .included_in) (in .included_in $target) }}
      <div class="cv-experience-item">
        {{ if .roles }}
        {{ $includedRoles := slice }}
        {{ range .roles }}
          {{ if or (not .included_in) (in .included_in $target) }}
            {{ $includedRoles = $includedRoles | append . }}
          {{ end }}
        {{ end }}

        {{ if gt (len $includedRoles) 0 }}
          {{ $current := index $includedRoles (sub (len $includedRoles) 1) }}
          {{ range $includedRoles }}
            {{ if eq .end_date "present" }}
              {{ $current = . }}
            {{ end }}
          {{ end }}

          {{ $currentStart := ($current.start_date | replaceRE "^(\\d{4}).*" "$1") }}
          {{ $currentEnd := "" }}
          {{ if eq $current.end_date "present" }}
            {{ $currentEnd = "Present" }}
          {{ else }}
            {{ $currentEnd = ($current.end_date | replaceRE "^(\\d{4}).*" "$1") }}
          {{ end }}

          <h3>{{ $current.title }} - {{ .company }}</h3>
          <p class="cv-meta">{{ $currentStart }} – {{ $currentEnd }}, {{ .location }}</p>

          {{ $prevBits := slice }}
          {{ range sort $includedRoles "start_date" "desc" }}
            {{ if ne .end_date "present" }}
              {{ $t := replace .title " Applied Scientist" "" }}
              {{ $sy := (.start_date | replaceRE "^(\\d{4}).*" "$1") }}
              {{ $ey := "" }}
              {{ if eq .end_date "present" }}
                {{ $ey = "Present" }}
              {{ else }}
                {{ $ey = (.end_date | replaceRE "^(\\d{4}).*" "$1") }}
              {{ end }}
              {{ $prevBits = $prevBits | append (printf "%s (%s–%s)" $t $sy $ey) }}
            {{ end }}
          {{ end }}
          {{ if gt (len $prevBits) 0 }}
            <p class="cv-meta">Previously: {{ delimit $prevBits " • " }}</p>
          {{ end }}
        {{ end }}
        <ul>
          {{ range .highlights }}
          {{ if or (not .included_in) (in .included_in $target) }}
          <li>{{ .text }}</li>
          {{ end }}
          {{ end }}
        </ul>
        {{ else }}
        <h3>{{ .title }} - {{ .company }}</h3>
        <p class="cv-meta">{{ .start_date | replaceRE "^(\\d{4})-(\\d{2})$" "$1" }} – {{ if eq .end_date "present" }}Present{{ else }}{{ .end_date | replaceRE "^(\\d{4})-(\\d{2})$" "$1" }}{{ end }}, {{ .location }}</p>
        <ul>
          {{ range .highlights }}
          {{ if or (not .included_in) (in .included_in $target) }}
          <li>{{ .text }}</li>
          {{ end }}
          {{ end }}
        </ul>
        {{ end }}
      </div>
      {{ end }}
      {{ end }}
    </section>

    <section class="cv-section">
      <h2>Education</h2>
      {{ range $p.education }}
      {{ if or (not .included_in) (in .included_in $target) }}
      <div class="cv-education-item">
        <h3>{{ .degree }}, {{ .institution }}</h3>
        {{ with .focus }}<p>Focus: {{ . }}</p>{{ end }}
        {{ if .thesis }}<p>Thesis: {{ .thesis }}{{ with .minor }}. {{ . }} Minor.{{ end }}</p>{{ end }}
        {{ with .technologies }}<p>Technologies: {{ delimit . ", " }}</p>{{ end }}
      </div>
      {{ end }}
      {{ end }}
    </section>

    <section class="cv-section">
      <h2>Publications</h2>
      <ol class="cv-publications">
        {{ range $p.publications }}
        {{ if or (not .included_in) (in .included_in $target) }}
        <li>
          {{ delimit .authors ", " }}, "{{ if .doi }}<a href="https://doi.org/{{ .doi }}">{{ .title }}</a>{{ else }}{{ .title }}{{ end }}," <em>{{ .venue }}</em>{{ with .volume }}, vol. {{ . }}{{ end }}{{ with .issue }}, no. {{ . }}{{ end }}{{ with .page }}, p. {{ . }}{{ end }}{{ with .pages }}, pp. {{ . }}{{ end }}, {{ .year }}.
        </li>
        {{ end }}
        {{ end }}
      </ol>
    </section>

    <section class="cv-section">
      <h2>Projects</h2>
      <ul class="cv-projects">
        {{ range $p.projects }}
        {{ if or (not .included_in) (in .included_in $target) }}
        <li>
          <a href="{{ .url }}">{{ .name }}</a>: {{ .description }}
        </li>
        {{ end }}
        {{ end }}
      </ul>
    </section>
  </div>
</article>
{{ end }}
